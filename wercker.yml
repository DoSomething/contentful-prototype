box: dosomething/ds-docker-php:7.2

build:
  steps:
    - script:
        name: configure environment
        code: cp .env.example .env
    - leipert/composer-install@0.9.1
    - wercker/npm-install
    - script:
        name: run phpunit test suite
        code: |-
          php artisan key:generate
          php artisan gateway:key
          vendor/bin/phpunit
    - script:
        name: check code style
        code: npm run lint
    - script:
        name: run type checker
        code: npm run flow
    # @todo We are temporarily disabling running our JS test suite since we currently seem to
    # have an issue with Jest and a circular dependency on ContentfulEntry. We are  planning
    # on reassessing our tests and fixing things up post our current big initiative with
    # StoryPages and ungated actions. (2019-02-27)
    # @see https://www.pivotaltracker.com/story/show/164282294
    # - script:
    #     name: test javascript code
    #     code: npm run test:ci
    - script:
        name: build front-end assets
        code: npm run build
